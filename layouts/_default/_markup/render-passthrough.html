{{- $opts := dict "output" "htmlAndMathml" "displayMode" (eq .Type "block") -}}
{{- with try (transform.ToMath .Inner $opts) -}}
  {{- with .Err -}}
    {{- errorf "KaTeX render error: %s (%s)" . $.Position -}}
  {{- else -}}
    {{- .Value -}}
    {{- $.Page.Store.Set "hasMath" true -}}
  {{- end -}}
{{- end -}}
